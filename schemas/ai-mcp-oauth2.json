{
  "fields": [
    {
      "consumer": {
        "type": "foreign",
        "description": "Custom type for representing a foreign key with a null value allowed.",
        "reference": "consumers",
        "eq": null
      }
    },
    {
      "consumer_group": {
        "type": "foreign",
        "description": "Custom type for representing a foreign key with a null value allowed.",
        "reference": "consumer_groups",
        "eq": null
      }
    },
    {
      "protocols": {
        "type": "set",
        "description": "A set of strings representing HTTP protocols.",
        "default": [
          "grpc",
          "grpcs",
          "http",
          "https"
        ],
        "elements": {
          "one_of": [
            "grpc",
            "grpcs",
            "http",
            "https"
          ],
          "type": "string"
        },
        "required": true
      }
    },
    {
      "config": {
        "entity_checks": [
          {
            "conditional_at_least_one_of": {
              "if_field": "client_id",
              "then_at_least_one_of": [
                "client_secret",
                "client_jwk",
                "tls_client_auth_cert"
              ],
              "if_match": {
                "required": true
              }
            }
          },
          {
            "conditional": {
              "then_field": "tls_client_auth_key",
              "if_field": "tls_client_auth_cert",
              "then_match": {
                "required": true
              },
              "if_match": {
                "required": true
              }
            }
          },
          {
            "conditional": {
              "then_field": "tls_client_auth_cert",
              "if_field": "tls_client_auth_key",
              "then_match": {
                "required": true
              },
              "if_match": {
                "required": true
              }
            }
          }
        ],
        "description": "The configuration for MCP authorization in OAuth2. If this is enabled, make sure the configured metadata_endpoint is also covered by the same route so the authorization can be applied correctly.",
        "type": "record",
        "required": true,
        "fields": [
          {
            "max_request_body_size": {
              "gt": -1,
              "type": "integer",
              "description": "max allowed body size allowed to be handled as MCP request. 0 means unlimited, but the size of this body will still be limited by Nginx's client_max_body_size.",
              "default": 1048576
            }
          },
          {
            "metadata_endpoint": {
              "starts_with": "/",
              "type": "string",
              "description": "The path for OAuth 2.0 Protected Resource Metadata. Default to $resource/.well-known/oauth-protected-resource. For example, if the configured resource is https://api.example.com/mcp, the metadata endpoint is /mcp/.well-known/oauth-protected-resource.",
              "match_none": [
                {
                  "err": "must not have empty segments",
                  "pattern": "//"
                }
              ]
            }
          },
          {
            "resource": {
              "type": "string",
              "required": true,
              "description": "The resource identifier."
            }
          },
          {
            "authorization_servers": {
              "elements": {
                "description": "The authorization server identifier.",
                "type": "string"
              },
              "type": "array",
              "required": true,
              "len_min": 1
            }
          },
          {
            "scopes_supported": {
              "elements": {
                "description": "Recommended scopes that are used in authorization requests to request access to this protected resource.",
                "type": "string"
              },
              "type": "array",
              "required": false,
              "len_min": 1
            }
          },
          {
            "claim_to_header": {
              "elements": {
                "fields": [
                  {
                    "claim": {
                      "type": "string",
                      "description": "The claim name to be used in the access token.",
                      "required": true
                    }
                  },
                  {
                    "header": {
                      "type": "string",
                      "description": "The HTTP header name to be used for forwarding the claim value to the upstream.",
                      "required": true
                    }
                  }
                ],
                "type": "record"
              },
              "type": "array",
              "required": false,
              "len_min": 1
            }
          },
          {
            "cache_introspection": {
              "type": "boolean",
              "description": "If enabled, the plugin will cache the introspection response for the access token. This can improve performance by reducing the number of introspection requests to the authorization server.",
              "default": true
            }
          },
          {
            "insecure_relaxed_audience_validation": {
              "type": "boolean",
              "description": "If enabled, the plugin will not validate the audience of the access token. Disable it if the authorization server does not correctly set the audience claim according to RFC 8707 and MCP specification.",
              "default": false
            }
          },
          {
            "introspection_endpoint": {
              "type": "string",
              "description": "The introspection endpoint URL.",
              "required": true
            }
          },
          {
            "mtls_introspection_endpoint": {
              "type": "string",
              "required": false,
              "description": "The mTLS alias for the introspection endpoint."
            }
          },
          {
            "client_id": {
              "referenceable": true,
              "type": "string",
              "required": true,
              "description": "The client ID for authentication."
            }
          },
          {
            "client_secret": {
              "type": "string",
              "description": "The client secret for authentication.",
              "encrypted": true,
              "referenceable": true,
              "required": false
            }
          },
          {
            "client_auth": {
              "one_of": [
                "client_secret_basic",
                "client_secret_post",
                "client_secret_jwt",
                "private_key_jwt",
                "tls_client_auth",
                "self_signed_tls_client_auth",
                "none"
              ],
              "type": "string",
              "description": "The client authentication method.",
              "required": false
            }
          },
          {
            "client_jwk": {
              "type": "string",
              "description": "The client JWK for private_key_jwt authentication.",
              "encrypted": true,
              "referenceable": true,
              "required": false
            }
          },
          {
            "client_alg": {
              "one_of": [
                "HS256",
                "HS384",
                "HS512",
                "RS256",
                "RS384",
                "RS512",
                "ES256",
                "ES384",
                "ES512",
                "PS256",
                "PS384",
                "PS512",
                "EdDSA"
              ],
              "type": "string",
              "description": "The client JWT signing algorithm.",
              "required": false
            }
          },
          {
            "tls_client_auth_cert": {
              "type": "string",
              "description": "PEM-encoded client certificate for mTLS.",
              "required": false
            }
          },
          {
            "tls_client_auth_key": {
              "type": "string",
              "description": "PEM-encoded private key for mTLS.",
              "required": false
            }
          },
          {
            "tls_client_auth_ssl_verify": {
              "description": "Verify server certificate in mTLS.",
              "type": "boolean",
              "required": false,
              "default": true
            }
          },
          {
            "args": {
              "type": "map",
              "description": "Additional arguments to send in the POST body.",
              "values": {
                "type": "string"
              },
              "required": false,
              "keys": {
                "type": "string"
              }
            }
          },
          {
            "headers": {
              "type": "map",
              "description": "Additional headers for the introspection request.",
              "values": {
                "type": "string"
              },
              "required": false,
              "keys": {
                "type": "string"
              }
            }
          },
          {
            "keepalive": {
              "description": "Enable HTTP keepalive for requests.",
              "type": "boolean",
              "required": false,
              "default": true
            }
          },
          {
            "ssl_verify": {
              "description": "Verify the SSL certificate.",
              "type": "boolean",
              "required": false,
              "default": true
            }
          },
          {
            "http_version": {
              "required": false,
              "type": "number",
              "description": "The HTTP version used for requests.",
              "default": 1.1
            }
          },
          {
            "timeout": {
              "description": "Network I/O timeout in milliseconds.",
              "type": "number",
              "required": false,
              "default": 10000
            }
          },
          {
            "http_proxy": {
              "type": "string",
              "required": false,
              "description": "HTTP proxy to use."
            }
          },
          {
            "http_proxy_authorization": {
              "type": "string",
              "description": "HTTP proxy authorization header.",
              "required": false
            }
          },
          {
            "https_proxy": {
              "type": "string",
              "required": false,
              "description": "HTTPS proxy to use."
            }
          },
          {
            "https_proxy_authorization": {
              "type": "string",
              "description": "HTTPS proxy authorization header.",
              "required": false
            }
          },
          {
            "no_proxy": {
              "type": "string",
              "description": "Comma-separated list of hosts to exclude from proxy.",
              "required": false
            }
          },
          {
            "introspection_format": {
              "one_of": [
                "string",
                "base64",
                "base64url"
              ],
              "type": "string",
              "description": "Controls introspection response format.",
              "required": false
            }
          }
        ]
      }
    }
  ],
  "entity_checks": []
}